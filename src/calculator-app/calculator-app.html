<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">

<dom-module id="calculator-app">
  <template>
    <style>
      :host {
        display: block;
      }

      .numbers{
        width: 300px;
        border: solid black;
      }

      .numbers paper-button{
        height: 80px;
      }
    </style>

    {{entry}}
    <br>
    {{calculate_answer(entry)}}
    <div class="numbers">
      <paper-button on-tap='tap_number'>1</paper-button>
      <paper-button on-tap='tap_number'>2</paper-button>
      <paper-button on-tap='tap_number'>3</paper-button>
      <paper-button on-tap='tap_number'>4</paper-button>
      <paper-button on-tap='tap_number'>5</paper-button>
      <paper-button on-tap='tap_number'>6</paper-button>
      <paper-button on-tap='tap_number'>7</paper-button>
      <paper-button on-tap='tap_number'>8</paper-button>
      <paper-button on-tap='tap_number'>9</paper-button>
      <paper-button on-tap='tap_number'>0</paper-button>
      <paper-button on-tap='tap_number'>.</paper-button>
      <paper-button on-tap='tap_number'>=</paper-button>
    </div>
    <div class="operations">
      <paper-button on-tap='tap_delete'>del</paper-button>
      <paper-button on-tap='tap_number'>+</paper-button>
      <paper-button on-tap='tap_number'>-</paper-button>
      <paper-button on-tap='tap_number'>*</paper-button>
      <paper-button on-tap='tap_number'>/</paper-button>
    </div>
  </template>

  <script>
    Polymer({

      is: 'calculator-app',

      properties: {
        entry: {
          type: String,
          value: ''
        }
      },

      tap_number: function(event){
      let button = Polymer.dom(event).rootTarget.textContent.trim();
        this.entry = String(this.entry) + String(button);
      },

      tap_delete: function(event){
        this.entry = /(.*)(.+)/g.exec(this.entry)[1];
      },

      calculate_answer: function(entry){
        //we do multiplications
        let parenthesis = /\(([^()]*?)\)/;
        let multiplication =  /(\d+)\*(\d+)/;
        let division =  /(\d+)\/(\d+)/;
        let addition =  /(\d+)\+(\d+)/;
        let substraction =  /(\d+)\-(\d+)/;

        let m = entry.match(parenthesis);
        while(m){
          entry = entry.replace(parenthesis, this.calculate_answer(m[1]))
          m = entry.match(parenthesis);
        }

        m = entry.match(multiplication);
        while(m){
          entry = entry.replace(multiplication, parseFloat(m[1]) * parseFloat(m[2]))
          m = entry.match(multiplication);
        }

        m = entry.match(division);
        while(m){
          entry = entry.replace(division, parseFloat(m[1]) / parseFloat(m[2]))
          m = entry.match(division);
        }

        m = entry.match(addition);
        while(m){
          entry = entry.replace(addition, parseFloat(m[1]) + parseFloat(m[2]))
          m = entry.match(addition);
        }

        m = entry.match(substraction);
        while(m){
          entry = entry.replace(substraction, parseFloat(m[1]) - parseFloat(m[2]))
          m = entry.match(substraction);
        }

        return entry;
      }

    });
  </script>
</dom-module>
